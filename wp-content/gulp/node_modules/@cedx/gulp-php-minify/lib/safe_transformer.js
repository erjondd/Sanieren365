"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const child_process_1 = require("child_process");
const path_1 = require("path");
const util_1 = require("util");
class SafeTransformer {
    constructor(_executable = 'php') {
        this._executable = _executable;
    }
    close() {
        return Promise.resolve();
    }
    async transform(script) {
        const spawn = util_1.promisify(child_process_1.execFile);
        const { stdout } = await spawn(path_1.normalize(this._executable), ['-w', path_1.resolve(script)], { maxBuffer: SafeTransformer.bufferSize });
        return stdout;
    }
}
SafeTransformer.bufferSize = 8 * 1024 * 1024;
exports.SafeTransformer = SafeTransformer;
//# sourceMappingURL=safe_transformer.js.map